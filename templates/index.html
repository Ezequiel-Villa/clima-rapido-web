<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Clima r√°pido</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- CSS -->
  <link rel="stylesheet" href="/static/css/style.css" />
</head>
<body>
  <div class="container">
    <!-- Encabezado -->
    <header class="header">
      <div class="header-left">
        <span class="badge">Eze-Weather</span>
        <h1>üå§Ô∏è Clima al Instante</h1>
      </div>
      <div class="header-right">
        <!-- Reloj local (del navegador) -->
        <div class="clock" id="clock-local" title="Hora local">--:--:--</div>
      </div>
    </header>

    <!-- Tarjeta principal -->
    <section class="card">
      <!--
        Formulario con:
        - action="/weather" = fallback cl√°sico si JS est√° desactivado
        - id="form-weather" = para interceptar el submit en JS y evitar recarga
        - Validaciones HTML5 + patr√≥n permisivo (letras, acentos, espacios, n√∫meros, comas, puntos, guiones, ap√≥strofes)
      -->
      <form id="form-weather" method="POST" action="/weather" novalidate>
        <div class="row">
          <div>
            <label for="city">Ciudad</label>
            <input
              id="city"
              name="city"
              type="text"
              placeholder="Ej. Tijuana, MX"
              autocomplete="address-level2"
              required
              maxlength="80"
              pattern="^[\\p{L}\\p{M}0-9\\s,'\\.\\-]{1,80}(,\\s?[A-Za-z]{2})?$"
              title="Ejemplo v√°lido: 'Tijuana' o 'Tijuana, MX'"
            />
            <small id="city-help" class="muted">
              Formato sugerido: <b>Ciudad</b> o <b>Ciudad, C√≥digo de pa√≠s</b> ‚Äî ej. <em>Tijuana, MX</em>.
            </small>
            <div id="city-error" class="field-error" aria-live="polite"></div>
          </div>

          <div>
            <label for="units">Unidades</label>
            <select id="units" name="units">
              <option value="metric" {{ 'selected' if default_units == 'metric' else '' }}>M√©trico (¬∞C)</option>
              <option value="imperial" {{ 'selected' if default_units == 'imperial' else '' }}>Imperial (¬∞F)</option>
            </select>
          </div>

          <div>
            <label for="lang">Idioma</label>
            <select id="lang" name="lang">
              <option value="es" {{ 'selected' if default_lang == 'es' else '' }}>Espa√±ol</option>
              <option value="en" {{ 'selected' if default_lang == 'en' else '' }}>Ingl√©s</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button type="submit" aria-describedby="city-help">
            <span class="btn-label">Consultar clima</span>
          </button>
          <span class="muted tip">Tip: ‚ÄúCiudad, C√≥digo de pa√≠s‚Äù (Tijuana, MX)</span>
        </div>
      </form>

      <!-- Resultado din√°mico (clima actual) -->
      <div id="result" class="result" aria-live="polite">
        {% if error %}
          <div class="error" role="alert">
            <strong>Ocurri√≥ un error:</strong>
            <span>{{ error }}</span>
          </div>
        {% elif result %}
          {% set temp_unit = "¬∞C" if result.units == "metric" else "¬∞F" if result.units == "imperial" else "K" %}
          <article class="weather-current">
            <header class="weather-header">
              <div class="weather-location">
                <h2>{{ result.city }}</h2>
                <p class="muted">{{ result.desc | capitalize }}</p>
              </div>
              {% if result.icon %}
                <img
                  src="https://openweathermap.org/img/wn/{{ result.icon }}@2x.png"
                  alt="Icono del clima: {{ result.desc }}"
                  width="80"
                  height="80"
                  loading="lazy"
                />
              {% endif %}
            </header>
            <dl class="weather-details">
              {% if result.temp is not none %}
                <div>
                  <dt>Temperatura</dt>
                  <dd>{{ result.temp }} {{ temp_unit }}</dd>
                </div>
              {% endif %}
              {% if result.feels_like is not none %}
                <div>
                  <dt>Sensaci√≥n</dt>
                  <dd>{{ result.feels_like }} {{ temp_unit }}</dd>
                </div>
              {% endif %}
              {% if result.humidity is not none %}
                <div>
                  <dt>Humedad</dt>
                  <dd>{{ result.humidity }} %</dd>
                </div>
              {% endif %}
              {% if result.pressure is not none %}
                <div>
                  <dt>Presi√≥n</dt>
                  <dd>{{ result.pressure }} hPa</dd>
                </div>
              {% endif %}
              {% if result.wind_speed is not none %}
                <div>
                  <dt>Viento</dt>
                  <dd>
                    {{ result.wind_speed }}
                    {% if result.units == "imperial" %}mph{% else %}m/s{% endif %}
                  </dd>
                </div>
              {% endif %}
            </dl>
            {% if from_cache %}
              <p class="muted cache-indicator">Datos servidos desde cach√©.</p>
            {% endif %}
          </article>
        {% else %}
          <p>Sin resultados a√∫n. Ingresa una ciudad y consulta.</p>
        {% endif %}
      </div>

      <!-- Pron√≥stico 5 d√≠as (se inserta por JS) -->
      <div id="forecast" aria-live="polite">
        {% if forecast5 %}
          <section class="forecast-grid">
            {% for day in forecast5 %}
              <article
                class="forecast-card"
                tabindex="0"
                aria-label="Pron√≥stico para {{ day.day }} ({{ day.date }})"
              >
                <header class="forecast-card-header">
                  <h3>{{ day.day }}</h3>
                  <p class="muted">{{ day.date }}</p>
                </header>
                {% if day.icon %}
                  <img
                    src="https://openweathermap.org/img/wn/{{ day.icon }}@2x.png"
                    alt="Pron√≥stico: {{ day.desc }}"
                    width="60"
                    height="60"
                    loading="lazy"
                  />
                {% endif %}
                <div class="forecast-temps" role="group" aria-label="Temperaturas m√°xima y m√≠nima">
                  <span class="temp-badge max" aria-label="Temperatura m√°xima">‚ñ≤ {{ day.temp_max }} {% if result and result.units == "imperial" %}¬∞F{% else %}¬∞C{% endif %}</span>
                  <span class="temp-badge min" aria-label="Temperatura m√≠nima">‚ñº {{ day.temp_min }} {% if result and result.units == "imperial" %}¬∞F{% else %}¬∞C{% endif %}</span>
                </div>
                {% if day.pop is not none %}
                  <p class="muted">Prob. precipitaci√≥n: {{ (day.pop * 100) | round(0) }}%</p>
                {% endif %}
                {% if day.desc %}
                  <p class="muted">{{ day.desc | capitalize }}</p>
                {% endif %}
              </article>
            {% endfor %}
          </section>
          {% if from_cache %}
            <p class="muted cache-indicator">Pron√≥stico obtenido desde cach√©.</p>
          {% endif %}
        {% endif %}
      </div>
    </section>

    <!-- Historial de b√∫squedas (se inserta por JS) -->
    <div id="history-root"></div>

    <section class="card support-card" aria-labelledby="support-heading">
      <h2 id="support-heading">Recursos para obtener mejores consultas</h2>
      <p class="muted">
        Aprovecha estos consejos r√°pidos y recursos confiables para mejorar tus b√∫squedas y comprender los datos del clima.
      </p>
      <ul class="support-tips">
        <li>
          <span class="support-icon" aria-hidden="true">üí°</span>
          <div>
            <h3>Especifica la ubicaci√≥n completa</h3>
            <p>Incluye ciudad y c√≥digo de pa√≠s cuando sea posible para evitar confusiones entre localidades con el mismo nombre.</p>
          </div>
        </li>
        <li>
          <span class="support-icon" aria-hidden="true">üïí</span>
          <div>
            <h3>Consulta diferentes momentos del d√≠a</h3>
            <p>Revisa el pron√≥stico por horas para planificar actividades seg√∫n los cambios de temperatura y precipitaci√≥n.</p>
          </div>
        </li>
        <li>
          <span class="support-icon" aria-hidden="true">üìç</span>
          <div>
            <h3>Guarda tus b√∫squedas frecuentes</h3>
            <p>Utiliza el historial para regresar r√°pidamente a tus ciudades favoritas y comparar condiciones.</p>
          </div>
        </li>
      </ul>
      <h3>Enlaces √∫tiles para profundizar</h3>
      <ul class="support-links">
        <li>
          <a href="https://openweathermap.org/api" rel="noopener" target="_blank">Documentaci√≥n oficial de la API de OpenWeather</a>
        </li>
        <li>
          <a href="https://www.ready.gov/es/clima-extremo" rel="noopener" target="_blank">Gu√≠a de preparaci√≥n ante clima extremo (Ready.gov)</a>
        </li>
        <li>
          <a href="https://es.wikipedia.org/wiki/√çndice_de_calor" rel="noopener" target="_blank">Aprende a interpretar el √≠ndice de calor</a>
        </li>
      </ul>
    </section>
  </div>

  <!-- JS (AJAX). Si quitas este script, el formulario caer√° al modo cl√°sico con recarga -->
  <script defer src="/static/js/app.js"></script>

  <noscript>
    <div class="noscript-note">
      JavaScript desactivado: usar√°s el modo cl√°sico (la p√°gina se recarga y el servidor renderiza el resultado).
    </div>
  </noscript>
</body>
</html>
